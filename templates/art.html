<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtGallery - Discover & Share Art</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0V4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#home">ArtGallery</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <form class="d-flex ms-auto me-3" role="search" id="search-form">
                    <!-- The form now submits to the server, causing a page reload with search results -->
                    <input class="form-control me-2 rounded-pill" type="search" name="search" placeholder="Search artworks..." aria-label="Search" id="search-input" value="{{ search_term or '' }}">
                    <!-- The button is now a standard submit button -->
                    <button class="btn btn-outline-primary rounded-pill" type="submit">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
                <ul class="navbar-nav align-items-center">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#gallery">Gallery</a>
                    </li>
                    <!-- Role-Specific Links -->
                    <li class="nav-item" id="myArtworksNavLink" style="display: none;">
                        <a class="nav-link" href="#my-artworks">My Artworks</a>
                    </li>
                    <li class="nav-item" id="orderHistoryNavLink" style="display: none;">
                        <a class="nav-link" href="#order-history">Order History</a>
                    </li>
                    <li class="nav-item" id="salesDashboardNavLink" style="display: none;">
                        <a class="nav-link" href="#sales-dashboard">Sales Dashboard</a>
                    </li>
                    <li class="nav-item" id="adminDashboardNavLink" style="display: none;">
                        <a class="nav-link" href="/admin/dashboard">Admin Dashboard</a>
                    </li>
                    <!-- General Links -->
                    <li class="nav-item">
                        <a class="nav-link" href="#about">About Us</a>
                    </li>
                    <!-- Auth & User Action Links -->
                    <li class="nav-item" id="loginRegisterNavLink">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#loginRegisterModal">Login/Register</a>
                    </li>
                    <li class="nav-item" id="profileNavLink" style="display: none;">
                        <a class="nav-link" href="#profile">My Profile</a>
                    </li>
                    <li class="nav-item" id="cartNavLink" style="display: none;">
                        <a class="nav-link position-relative" href="#" data-bs-toggle="modal" data-bs-target="#cartModal">
                            <i class="fas fa-shopping-cart"></i>
                            <span id="cart-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;"></span>
                        </a>
                    </li>
                    <li class="nav-item" id="uploadArtworkNavLink" style="display: none;">
                        <a class="nav-link btn btn-primary text-white rounded-pill px-3 ms-2" href="#" data-bs-toggle="modal" data-bs-target="#uploadArtworkModal">Upload Artwork</a>
                    </li>
                    <li class="nav-item" id="logoutNavLink" style="display: none;">
                        <a class="nav-link btn btn-outline-danger rounded-pill px-3 ms-2" href="#">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero-section text-center text-white d-flex align-items-center justify-content-center">
        <div class="container">
            <h1 class="display-4 fw-bold">Discover Your Next Masterpiece</h1>
            <p class="lead">A curated collection of art from talented artists around the world.</p>
            <a href="#gallery" class="btn btn-primary btn-lg rounded-pill">Explore Gallery</a>
        </div>
    </section>

    <!-- Gallery Section -->
    <section id="gallery" class="py-5">
        <div class="container">
            <h2 id="gallery-title" class="text-center mb-5">Featured Artworks</h2>
            <!-- The container is now populated by the server using Jinja2 -->
            <div id="artworks-container" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                {% if artworks %}
                    {% for artwork in artworks %}
                    <div class="col artwork-card">
                        <div class="card h-100 shadow-sm" data-id="{{ artwork.id }}">
                            <!-- The image URL is now constructed on the server -->
                            <img src="{{ url_for('serve_upload', filename=artwork.image_path) }}" class="card-img-top object-fit-cover" alt="{{ artwork.title }}" style="height: 200px;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ artwork.title }}</h5>
                                {% if artwork.artist %}
                                <p class="card-text text-muted mb-1">by {{ artwork.artist.username }}</p>
                                {% endif %}
                                <p class="card-text text-muted mb-3">{{ artwork.category }}</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <!-- The price is formatted on the server -->
                                    <span class="artwork-price">${"%.2f"|format(artwork.price)}}</span>
                                    <!-- The "View Details" button still relies on JavaScript to open the modal -->
                                    <button class="btn btn-sm btn-outline-primary rounded-pill view-details-btn" data-id="{{ artwork.id }}">View Details</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <!-- This message is shown if no artworks are found -->
                    <div class="col-12 text-center py-5">
                        <p class="text-muted fs-5">
                            {% if search_term %}No artworks found for "{{ search_term }}".{% else %}No artworks found.{% endif %}
                        </p>
                    </div>
                {% endif %}
            </div>
            <div class="text-center mt-5">
                <button id="loadMoreBtn" class="btn btn-outline-secondary rounded-pill">Load More</button>
            </div>
        </div>
    </section>

    <!-- My Artworks Section (for artists) -->
    <section id="my-artworks" class="py-5 bg-light" style="display: none;">
        <div class="container">
            <h2 class="text-center mb-5">My Uploaded Artworks</h2>
            <div id="my-artworks-container" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                <!-- Artist's artworks will be injected here by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Order History Section -->
    <section id="order-history" class="py-5 bg-light" style="display: none;">
        <div class="container">
            <h2 class="text-center mb-5">My Order History</h2>
            <div id="order-history-container" class="accordion">
                <!-- Orders will be injected here as accordion items by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Sales Dashboard Section (for artists) -->
    <section id="sales-dashboard" class="py-5 bg-light" style="display: none;">
        <div class="container">
            <h2 class="text-center mb-5">My Sales Dashboard</h2>
            <div id="sales-dashboard-summary" class="row text-center mb-5">
                <!-- Summary cards will be injected here -->
            </div>
            <div id="sales-dashboard-container">
                <table class="table table-hover align-middle">
                    <thead>
                        <!-- Header will be injected by JS -->
                    </thead>
                    <tbody>
                        <!-- Rows will be injected by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Reset Password Section -->
    <section id="reset-password" class="py-5 bg-light" style="display: none;">
        <div class="container" style="max-width: 500px;">
            <h2 class="text-center mb-4">Reset Your Password</h2>
            <div class="card card-body shadow-sm">
                <form id="resetPasswordForm">
                    <input type="hidden" id="resetTokenInput">
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="resetNewPassword" placeholder="New Password" required>
                        <label for="resetNewPassword">New Password</label>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Reset Password</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Profile Section -->
    <section id="profile" class="py-5 bg-light" style="display: none;">
        <div class="container" style="max-width: 800px;">
            <h2 class="text-center mb-5">My Profile</h2>
            <div class="row">
                <!-- Update Profile Details -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Account Details</h5>
                            <form id="updateProfileForm">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="profileUsername" placeholder="Username" required>
                                    <label for="profileUsername">Username</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" id="profileEmail" placeholder="Email" readonly disabled>
                                    <label for="profileEmail">Email (cannot be changed)</label>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Save Changes</button>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Change Password -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title mb-4">Change Password</h5>
                            <form id="changePasswordForm">
                                <div class="form-floating mb-3"><input type="password" class="form-control" id="currentPassword" placeholder="Current Password" required><label for="currentPassword">Current Password</label></div>
                                <div class="form-floating mb-3"><input type="password" class="form-control" id="newPassword" placeholder="New Password" required><label for="newPassword">New Password</label></div>
                                <button type="submit" class="btn btn-secondary w-100">Update Password</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Role-Specific Content Area -->
            <div class="mt-5">
                <h4 id="role-specific-title" class="text-center mb-4" style="display: none;"></h4>
                <div id="role-specific-content" class="row justify-content-center g-3">
                    <!-- Dynamic content for artists or buyers will be injected here by JavaScript -->
                </div>
            </div>

        </div>
    </section>

    <!-- About Us Section -->
    <section id="about" class="bg-light py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h2>About ArtGallery</h2>
                    <p>We are a passionate community dedicated to connecting art lovers with talented artists. Our platform provides a space for artists to showcase their work and for collectors to discover unique pieces.</p>
                    <p>From traditional paintings to modern digital art, ArtGallery is your gateway to a world of creativity and inspiration.</p>
                </div>
                <div class="col-md-6 text-center">
                    <img src="https://picsum.photos/500/300?random=1" class="img-fluid rounded shadow" alt="Art gallery display">
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4">
        <div class="container">
            <p>&copy; 2025 ArtGallery. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Login/Register Modal -->
    <div class="modal fade" id="loginRegisterModal" tabindex="-1" aria-labelledby="loginRegisterModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginRegisterModalLabel">Join ArtGallery</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Pills navs -->
                    <ul class="nav nav-pills nav-justified mb-3" id="ex1" role="tablist">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" id="pills-login-tab" data-bs-toggle="pill" href="#pills-login" role="tab" aria-controls="pills-login" aria-selected="true">Login</a>
                        </li>
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" id="pills-register-tab" data-bs-toggle="pill" href="#pills-register" role="tab" aria-controls="pills-register" aria-selected="false">Register</a>
                        </li>
                    </ul>
                    <!-- Pills navs -->

                    <!-- Pills content -->
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="pills-login" role="tabpanel" aria-labelledby="pills-login-tab">
                            <form id="loginForm">
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" id="loginEmail" placeholder="name@example.com" required>
                                    <label for="loginEmail">Email address</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="password" class="form-control" id="loginPassword" placeholder="Password" required>
                                    <label for="loginPassword">Password</label>
                                </div>
                                <div class="text-center mb-3">
                                    <a href="#" id="forgotPasswordLink">Forgot password?</a>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Sign in</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="pills-forgot" role="tabpanel" aria-labelledby="pills-login-tab">
                            <p class="text-center text-muted">Enter your email and we'll send you a link to reset your password.</p>
                            <form id="forgotPasswordForm">
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" id="forgotEmail" placeholder="name@example.com" required>
                                    <label for="forgotEmail">Email address</label>
                                </div>
                                <div class="text-center mb-3">
                                    <a href="#" id="backToLoginLink">&larr; Back to Login</a>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Send Reset Link</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="pills-register" role="tabpanel" aria-labelledby="pills-register-tab">
                            <form id="registerForm">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="registerUsername" placeholder="Username" required>
                                    <label for="registerUsername">Username</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="email" class="form-control" id="registerEmail" placeholder="name@example.com" required>
                                    <label for="registerEmail">Email</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="password" class="form-control" id="registerPassword" placeholder="Password" required>
                                    <label for="registerPassword">Password</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="registerRole" required>
                                        <option value="" selected disabled>Select your role</option>
                                        <option value="buyer">I'm here to discover and buy art (Buyer)</option>
                                        <option value="artist">I'm an artist looking to sell my work (Artist)</option>
                                    </select>
                                    <label for="registerRole">I am a...</label>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Sign up</button>
                            </form>
                        </div>
                    </div>
                    <!-- Pills content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Artwork Detail Modal -->
    <div class="modal fade" id="artworkDetailModal" tabindex="-1" aria-labelledby="artworkDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="artworkDetailModalLabel">Artwork Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <img id="detailArtworkImage" src="" class="img-fluid rounded" alt="">
                        </div>
                        <div class="col-md-6">
                            <h3 id="detailArtworkTitle"></h3>
                            <p class="text-muted">by <span id="detailArtworkArtist"></span></p>
                            <p><strong>Category:</strong> <span id="detailArtworkCategory"></span></p>
                            <h4 class="text-primary">$<span id="detailArtworkPrice"></span></h4>
                            <p id="detailArtworkDescription" class="mt-3"></p>
                            <div id="purchase-actions" style="display: none;">
                                <button id="addToCartBtn" class="btn btn-success"><i class="fas fa-cart-plus me-2"></i>Add to Cart</button>
                            </div>
                            <hr>
                            <h5>Comments & Reviews</h5>
                            <div id="reviews-container" class="mb-4" style="max-height: 250px; overflow-y: auto;">
                                <!-- Reviews will be loaded here by JavaScript -->
                            </div>

                            <!-- Review Submission Form (for logged-in users) -->
                            <div id="review-form-container" style="display: none;">
                                <h6>Leave a Review</h6>
                                <form id="review-form">
                                    <input type="hidden" id="reviewArtworkId">
                                    <div class="mb-2">
                                        <label class="form-label">Your Rating</label>
                                        <div class="star-rating">
                                            <i class="far fa-star" data-value="1"></i>
                                            <i class="far fa-star" data-value="2"></i>
                                            <i class="far fa-star" data-value="3"></i>
                                            <i class="far fa-star" data-value="4"></i>
                                            <i class="far fa-star" data-value="5"></i>
                                        </div>
                                    </div>
                                    <textarea id="review-comment" class="form-control mb-2" rows="3" placeholder="Share your thoughts..."></textarea>
                                    <button type="submit" class="btn btn-primary btn-sm">Submit Review</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Artwork Modal -->
    <div class="modal fade" id="uploadArtworkModal" tabindex="-1" aria-labelledby="uploadArtworkModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="uploadArtworkModalLabel">Upload New Artwork</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm">
                        <div class="mb-3">
                            <label for="uploadArtworkTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="uploadArtworkTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="uploadArtworkDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="uploadArtworkDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="uploadArtworkPrice" class="form-label">Price ($)</label>
                                <input type="number" class="form-control" id="uploadArtworkPrice" step="0.01" min="0.01" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="uploadArtworkCategory" class="form-label">Category</label>
                                <select class="form-select" id="uploadArtworkCategory" required>
                                    <option value="" selected disabled>Choose a category...</option>
                                    <option value="Painting">Painting</option>
                                    <option value="Digital Art">Digital Art</option>
                                    <option value="Photography">Photography</option>
                                    <option value="Sculpture">Sculpture</option>
                                    <option value="Mixed Media">Mixed Media</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="uploadArtworkImage" class="form-label">Artwork Image</label>
                            <input class="form-control" type="file" id="uploadArtworkImage" accept="image/*" required>
                            <!-- Image Preview Container -->
                            <div id="imagePreviewContainer" class="mt-3 text-center" style="display: none;">
                                <p class="small text-muted mb-1">Image Preview:</p>
                                <img id="imagePreview" src="" class="img-fluid rounded" style="max-height: 200px;" alt="Image Preview">
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Upload</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Artwork Modal -->
    <div class="modal fade" id="editArtworkModal" tabindex="-1" aria-labelledby="editArtworkModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editArtworkModalLabel">Edit Artwork Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <!-- Hidden input to store artwork ID -->
                        <input type="hidden" id="editArtworkId">
                        <div class="mb-3">
                            <label for="editArtworkTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="editArtworkTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="editArtworkDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editArtworkDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editArtworkPrice" class="form-label">Price ($)</label>
                                <input type="number" class="form-control" id="editArtworkPrice" step="0.01" min="0.01" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editArtworkCategory" class="form-label">Category</label>
                                <select class="form-select" id="editArtworkCategory" required>
                                    <option value="Painting">Painting</option>
                                    <option value="Digital Art">Digital Art</option>
                                    <option value="Photography">Photography</option>
                                    <option value="Sculpture">Sculpture</option>
                                    <option value="Mixed Media">Mixed Media</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cartModalLabel">Your Shopping Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="cart-body">
                    <!-- Cart items will be injected here -->
                </div>
                <div class="modal-footer" id="cart-footer" style="display: none;">
                    <div class="w-100 d-flex justify-content-between align-items-center">
                        <h5>Total: <span id="cart-total" class="text-success">$0.00</span></h5>
                        <button id="checkout-btn" class="btn btn-primary">Proceed to Checkout</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and Popper.js --><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script><!-- Custom JavaScript --><script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>